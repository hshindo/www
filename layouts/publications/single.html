{{ define "card" }}
  {{ $index := .index}}
  {{ with .value }}

    {{ if gt $index 0 }}
      <div class="divider"></div>
    {{ end }}

    <div class="card-content">

      <!-- title -->
      {{ with .links.title }}<a href="{{ . }}" target="_blank">{{ end }}
      <div class="title">{{ add $index 1 }}. {{ .title }}</div>
      {{ with .links.title }}</a>{{ end }}

      <!-- authors -->
      <div class="line-container">
        <div class="icon-column">
          <i class="far fa-user-circle"></i>
        </div>
        <div class="contents-column authors">
          {{ range .authors }}
            <div class="author">{{ safeHTML . }}</div>
          {{ end }}
        </div>
      </div>

      <!-- booktitle and date -->
      <div class="line-container">
        <div class="icon-column">
          <i class="fas fa-book"></i>
        </div>
        {{ with .links.booktitle }}<a href="{{ . }}" target="_blank">{{ end }}
        <div class="contents-column booktitle">
          {{- .booktitle -}}
          {{- with .date -}}, {{.}}{{- end -}}
        </div>
        {{ with .links.booktitle }}</a>{{ end }}
      </div>

      <!-- links -->
      {{ with .links }}
        {{ if or (isset . "slides") (isset . "video") (isset . "pdf") (isset . "bibtex") (isset . "googleSlides") (isset . "googleSlidesInline") }}
          <div class="line-container">
            <div class="icon-column">
              <i class="fas fa-paperclip"></i>
            </div>
            <div class="contents-column links">
              {{ range $key, $value := .}}
                <!-- ignore `title` and `booktitle` -->
                {{ if and (ne $key "title") (ne $key "booktitle") }}
                  <!-- display specific vue component for google slides -->
                  {{ if (eq $key "googleSlides") }}
                    <my-google-slides src="{{ $value }}"></my-google-slides>
                  {{ else if (eq $key "googleSlidesInline") }}
                    <my-google-slides-inline src="{{ $value }}"></my-google-slides-inline>
                  <!-- display normal link for others -->
                  {{ else }}
                    <div><a href="{{ $value }}" target="_blank">{{ $key }}</a></div>
                  {{ end }}
                {{ end }}
              {{ end }}
            </div>
          </div>
        {{ end }}
      {{ end }}

    </div>

  {{ end }}
{{ end }}

{{ define "main" }}
  <!-- layout for `/publications/` -->

  <div id="publications" class="container">
    <div class="row">
      <div class="col s12 l8 offset-l2">
        <!--
          the first line's `$jsonFileName` becomes like `publications.(ja|en)`.
          and the second line loads $.Site.Data.`publications.(ja|en))`.

          In Go templates, you canâ€™t access array, slice, or map elements directly.
          e.g. $.Site.Data['publications.ja'] is not supported.
          SEE: https://gohugo.io/functions/index-function/
        -->
        {{ $jsonFileName := (printf "%s.%s" "publications" .Lang) }}
        {{ $json := index $.Site.Data $jsonFileName }}

        <!--
          the following code breaks the DRY principle
          because Hugo can't hold JSON key orders
        -->

        <!-- papers -->
        {{ with (index $json "papers") }}
          <h1>{{ i18n "papers" }}</h1>
          <div class="card">
            {{ range $index, $value := . }}
              {{ block "card" (dict "index" $index "value" $value) }}{{ end }}
            {{ end }}
          </div>
        {{end}}

        <!-- conferences -->
        {{ with (index $json "conferences") }}
          <h1>{{ i18n "conferences" }}</h1>
          <div class="card">
            {{ range $index, $value := . }}
              {{ block "card" (dict "index" $index "value" $value) }}{{ end }}
            {{ end }}
          </div>
        {{end}}

        <!-- conferencesInternational -->
        {{ with (index $json "conferencesInternational") }}
          <h1>{{ i18n "conferencesInternational" }}</h1>
          <div class="card">
            {{ range $index, $value := . }}
              {{ block "card" (dict "index" $index "value" $value) }}{{ end }}
            {{ end }}
          </div>
        {{end}}

        <!-- conferencesDomestic -->
        {{ with (index $json "conferencesDomestic") }}
          <h1>{{ i18n "conferencesDomestic" }}</h1>
          <div class="card">
            {{ range $index, $value := . }}
              {{ block "card" (dict "index" $index "value" $value) }}{{ end }}
            {{ end }}
          </div>
        {{end}}

        <!-- books -->
        {{ with (index $json "books") }}
          <h1>{{ i18n "books" }}</h1>
          <div class="card">
            {{ range $index, $value := . }}
              {{ block "card" (dict "index" $index "value" $value) }}{{ end }}
            {{ end }}
          </div>
        {{end}}

        <!-- others -->
        {{ with (index $json "others") }}
          <h1>{{ i18n "others" }}</h1>
          <div class="card">
            {{ range $index, $value := . }}
              {{ block "card" (dict "index" $index "value" $value) }}{{ end }}
            {{ end }}
          </div>
        {{end}}

      </div>
    </div>
  </div>
{{ end }}